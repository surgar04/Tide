地图制作工具（MapForge）功能设计规格书
一、 产品定位与核心设计原则
定位
一款为专业游戏开发设计的集成式地图编辑器，同时支持：

2D与3D 项目的视觉编辑与逻辑配置。

大地图（开放世界） 与 箱庭地图（精密关卡） 两种主流工作流。

设计原则
统一框架，模式切换：在同一个编辑器中，通过项目模板或设置，无缝切换不同地图类型的工作界面和核心工具集。

数据驱动，非破坏性编辑：所有操作基于资产和实例，确保可重复使用、易于迭代和版本控制。

所见即所得（WYSIWYG）：编辑视图的视觉效果与游戏运行时高度一致，包括光照、后期效果等。

性能感知设计：编辑过程中提供实时性能反馈，预防而非补救性能问题。

二、 核心编辑器框架功能
1. 用户界面与工作空间
可定制布局：支持拖拽、停靠、保存/加载自定义工作区布局。

多视图协同：

3D透视视图：主编辑窗口，支持多种渲染模式（带光照、线框、无光照、仅碰撞体等）。

2D顶视图/侧视图：用于精确对齐、平面布局和2D关卡设计。

场景图/层级树：以树状结构列出场景中所有对象（游戏物体、灯光、触发器、空节点等），支持多选、成组、搜索、过滤。

资产浏览器：集成式的资源库，浏览和管理所有模型、材质、纹理、音效、预设、脚本等。

属性检查器：动态显示当前选中对象（单个或多个）的所有可编辑属性，进行精细化调整。

主工具栏：快速访问选择、移动、旋转、缩放、地形笔刷、植被绘制等核心工具。

模式切换器：一键在“大地图编辑模式”和“箱庭关卡模式”间切换，界面和工具集相应变化。

2. 项目与数据管理
项目管理器：创建、打开、保存项目，管理项目内的所有地图文件。

统一的资产管道：

自动导入与热重载：将外部资源（FBX, PNG等）拖入特定文件夹，自动按预设规则导入并生成编辑器可用格式；修改源文件后，编辑器内实例自动更新。

资产数据库：为所有资源生成唯一ID（GUID），管理其元数据（用途、作者、版本）和引用关系。

预制件系统：将一组对象保存为可重复使用的预制件；修改预制件主资产，所有场景中的实例同步更新。

强大的撤销/重做系统：支持几乎所有操作的无限级撤销/重做，并清晰显示操作历史记录。

三、 通用编辑功能（2D/3D共用）
1. 场景对象操作
基础变换：移动（支持网格吸附、表面吸附）、旋转、缩放。

高级放置工具：

笔刷绘制：以笔刷形式随机密度、角度、大小放置物体（如植被、碎石）。

沿路径放置：沿绘制好的样条曲线，等距或随机放置物体（如路灯、护栏）。

阵列与对齐工具：快速创建对象阵列，或对齐、分布选中的多个对象。

2. 视觉与环境构建
光照系统：

支持方向光、点光源、聚光灯、面光源的放置与参数调整。

光照烘焙：可视化配置和预览光照贴图（Lightmap）的生成，支持全局光照（GI）。

光照探头：自动或手动放置光照探头，用于为动态物体提供高质量光照。

天空与大气：可配置的动态/静态天空盒、太阳角度、雾效（高度雾、距离雾）、体积云（3D）。

后期处理体积：在场景中划定区域，应用不同的色彩校正、环境光遮蔽、泛光等后期处理效果。

3. 游戏逻辑配置
区域与触发器：可视化绘制2D形状或3D体积（盒体、球体、自定义网格），并绑定事件（如：玩家进入、离开、持续在区域内）。

实体出生点：直观放置玩家出生点、NPC出生点、怪物刷新区域、物品生成点。

路径与路点系统：创建和编辑路径，供NPC巡逻、相机移动或物体飞行使用。

自定义脚本/组件挂载：允许将游戏逻辑脚本或内置行为组件（如旋转、移动平台）拖放到任何场景对象上，并通过属性检查器配置参数。

4. 物理与寻路
碰撞体编辑：为复杂模型快速添加简化碰撞体（盒体、胶囊、凸包），并设置物理材质（摩擦力、弹性）和触发标志。

导航网格生成与编辑：

一键为场景生成可行走区域（NavMesh）。

可视化编辑不可行走区域、跳跃连接、高度差连接。

支持为不同体型的AI设置不同的导航网格参数（如高度、坡度、跳跃距离）。

四、 针对“大地图”（开放世界）的专项功能
1. 大规模地形编辑
地形雕刻：使用具有衰减、形状、强度的笔刷进行拉升、压低、平整、平滑、捏造斜坡等操作。

地形绘画：

多层纹理混合：支持绘制多张地形纹理（泥土、草、岩石、雪）的权重，实现自然过渡。

顶点色绘制：直接在地形顶点上绘制颜色，用于控制着色细节或作为其他系统的输入（如积雪、潮湿区域）。

程序化地形生成：基于噪声（Perlin, Simplex）或导入高度图生成基础地形，并可模拟热侵蚀、水力侵蚀等自然效果。

2. 程序化内容生成与批量处理
生态群落/生物群落笔刷：将一组按生态规则（密度、分布、海拔/坡度限制）配置好的植被、岩石、杂物保存为“群落预设”，用笔刷快速绘制整个森林或草原。

道路与河流工具：通过绘制样条曲线，自动生成带有模型、UV、碰撞和寻路数据的道路与河床。

散射系统：基于规则（海拔、坡度、朝向）在选区内自动散布物体。

批量编辑工具：批量替换、修改、删除场景中大量同类型对象。

3. 世界分区与流式加载
分块编辑器：可视化地划分世界为多个区块（Chunk），并设置其流式加载/卸载的边界和优先级。

LOD（多层次细节）管理：为模型和地形配置LOD组，并在编辑器中实时预览不同距离下的细节切换效果。

数据层管理：将不同类型的数据（基础地形、静态模型、动态物体、光照数据）分层管理，便于按需流式加载。

4. 性能分析与优化工具
性能可视化视图：实时热力图显示三角形数量、绘制调用次数、纹理内存等关键性能指标，快速定位瓶颈。

遮挡剔除编辑器：可视化编辑和调试预计算的遮挡数据，确保流式加载和渲染效率。

五、 针对“箱庭地图”（关卡）的专项功能
1. 精密构造与布局
高级吸附系统：支持吸附到网格、顶点、边、表面法线，对构建建筑内部或平台跳跃关卡至关重要。

几何体布尔运算（3D）：允许对基础几何体进行并集、交集、差集运算，快速“雕刻”出房间、门窗等结构。

2D瓦片地图编辑器：

多层瓦片：支持背景层、地形层、装饰层、碰撞层等。

自动瓦片：智能识别瓦片邻接关系，自动填充正确边角图案。

瓦片笔刷：包含绘制、填充、矩形、椭圆等专用绘制工具。

动画瓦片与随机瓦片：支持在瓦片集中使用动画序列或随机变化的瓦片。

2. 叙事与序列设计
时间线/序列编辑器：创建和编辑过场动画，可以编排相机移动、角色动画、音频播放、物体显隐等事件。

镜头路径工具：为过场动画或脚本事件绘制和预览相机的运动轨迹。

触发器链：可视化地连接多个触发器，实现复杂的关卡流程逻辑（如：踩下压力板 -> 门升起 -> 播放声音 -> 刷怪）。

3. 谜题与机关设计
状态机编辑器：为可交互物体创建简单的视觉化状态逻辑（如：开关的“开”与“关”状态及其转换条件）。

动态物体动画：为门、电梯、移动平台等录制或编辑关键帧动画。

六、 生产管线与协作功能
1. 扩展与自动化
插件系统：提供完整的API，允许用户使用脚本（如Python, Lua）或编译型语言（如C#）创建自定义工具、导入器或扩展编辑器功能。

批量导出与发布：将地图和所有依赖资源打包、优化，导出为目标游戏引擎（如Unity, Unreal）的格式或运行时数据。

2. 团队协作支持
版本控制友好：地图数据文件设计为文本或可读的二进制格式（如JSON, Protobuf），支持Git等版本控制系统进行差异比较、分支和合并。

资产锁定（可选）：在团队环境中，可锁定他人正在编辑的图层或资产，防止冲突。

更改列表与评审：集成简单的任务和审阅系统，跟踪地图的修改历史。

3. 调试与预览
游戏内预览：一键在游戏实际运行环境中启动当前编辑的地图，并可选择“运行时编辑”模式进行微调。

调试信息叠加：在编辑视图或游戏预览中，实时显示碰撞体边框、导航网格、触发器范围、射线检测等调试信息。

七、 功能总结与模式对比
特性	大地图（开放世界）模式	箱庭地图（关卡）模式
核心思维	生成、管理、优化	雕琢、布局、叙事
地形编辑	核心功能，强 sculpt/paint/PCG	次要或无需，常用BSP/手动建模
物件放置	大规模、实例化、笔刷/规则散布	精密、手动、对齐吸附
数据结构	分块（Chunk） + LOD， 支持流式加载	分层（Layer） + 分组， 强调逻辑组织
性能工具	至关重要（LOD热力图、流加载调试）	重要（单场景优化、遮挡剔除）
关键工具	生态群落笔刷、程序化道路、世界分区器	瓦片地图编辑器、CSG布尔运算、时间线序列器
输出目标	广阔、无缝、性能优异的开放世界	紧凑、高密度、叙事驱动的独立关卡
核心共享模块：项目管理器、资产浏览器、场景图、属性检查器、基础变换工具、光照系统、逻辑触发器、寻路系统、物理碰撞、插件框架、调试预览。